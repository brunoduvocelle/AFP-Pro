<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARCHITECTE WEB - Veille Stratégique PRO</title>
    <style>
        :root {
            --bg: #0a0a0b;
            --card: #161618;
            --border: #2d2d30;
            --accent: #0070f3;
            --text-main: #efeff1;
            --text-dim: #a0a0a5;
            --scan: #00ff41;
            --alert: #ff4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            background: var(--bg); color: var(--text-main);
            display: grid; grid-template-columns: 1fr 380px; height: 100vh; overflow: hidden;
        }

        /* --- FLUX PRINCIPAL --- */
        #feed { 
            padding: 30px; overflow-y: auto; scroll-behavior: smooth;
            background: radial-gradient(circle at top left, #111, var(--bg));
        }
        
        .news-card {
            background: var(--card); border: 1px solid var(--border); border-radius: 10px;
            padding: 24px; margin-bottom: 20px; cursor: pointer;
            transition: transform 0.2s, border-color 0.2s; position: relative;
            animation: fadeIn 0.5s ease;
        }
        .news-card:hover { transform: translateY(-2px); border-color: var(--accent); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .news-card.is-fresh { border-left: 4px solid var(--alert); }
        .is-fresh::after {
            content: "NEW"; position: absolute; top: 10px; right: 10px;
            background: var(--alert); color: white; font-size: 9px; font-weight: bold;
            padding: 2px 6px; border-radius: 4px;
        }

        .meta { display: flex; align-items: center; gap: 12px; font-size: 11px; margin-bottom: 12px; }
        .source-tag { color: var(--accent); font-weight: 800; text-transform: uppercase; }
        .timestamp { color: var(--text-dim); font-family: 'Courier New', monospace; }
        
        .title { font-size: 1.25rem; font-weight: 600; margin-bottom: 12px; line-height: 1.3; color: #fff; }
        .desc { font-size: 0.95rem; color: var(--text-dim); line-height: 1.5; }

        /* --- BARRE LATERALE --- */
        aside { background: #000; border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .panel { padding: 20px; border-bottom: 1px solid var(--border); }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-box { background: #111; padding: 15px; border-radius: 8px; border: 1px solid #222; }
        .stat-val { font-size: 24px; font-weight: bold; color: var(--scan); }
        .stat-lbl { font-size: 9px; color: var(--text-dim); text-transform: uppercase; }

        .log-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; padding: 20px; }
        #console-log { 
            flex: 1; overflow-y: auto; font-family: 'Consolas', monospace; 
            font-size: 10px; color: #666; padding-top: 10px;
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #111; padding-bottom: 2px; }
        .log-entry.err { color: var(--alert); }
        .log-entry.ok { color: var(--scan); }

        /* --- CONTROLES --- */
        select, button {
            width: 100%; background: #1a1a1c; border: 1px solid var(--border);
            color: white; padding: 10px; border-radius: 6px; margin-top: 10px;
            cursor: pointer; font-size: 13px;
        }
        button.primary { background: var(--accent); font-weight: bold; border: none; }
        button.primary:hover { filter: brightness(1.2); }

        /* --- MODAL --- */
        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content { 
            background: var(--card); width: 90%; max-width: 800px; 
            padding: 40px; border-radius: 12px; border: 1px solid var(--border);
        }

        .scan-active { animation: pulse-border 1.5s infinite; }
        @keyframes pulse-border { 0% { box-shadow: 0 0 0 0 rgba(0,255,65,0.2); } 70% { box-shadow: 0 0 0 10px rgba(0,255,65,0); } 100% { box-shadow: 0 0 0 0 rgba(0,255,65,0); } }
    </style>
</head>
<body>

    <main id="feed">
        <div id="init-screen" style="text-align:center; padding-top:20vh;">
            <h1 style="font-size:3rem; margin-bottom:1rem;">SYSTEM READY</h1>
            <p style="color:var(--text-dim);">Cliquez pour initialiser le scan multi-sources</p>
            <button class="primary" style="width:200px; margin-top:20px;" onclick="App.start()">LANCER LE MONITORING</button>
        </div>
    </main>

    <aside>
        <div class="panel">
            <h4 style="font-size:11px; letter-spacing:2px; color:var(--text-dim);">MONITORING RÉSEAU</h4>
            <div class="stats-grid">
                <div class="stat-box">
                    <div id="stat-count" class="stat-val">0</div>
                    <div class="stat-lbl">Articles</div>
                </div>
                <div class="stat-box">
                    <div id="stat-sources" class="stat-val">0</div>
                    <div class="stat-lbl">Sources OK</div>
                </div>
            </div>
            
            <select id="freq" onchange="App.setFreq(this.value)">
                <option value="30000">Rafraîchissement : 30s</option>
                <option value="60000" selected>Rafraîchissement : 1m</option>
                <option value="300000">Rafraîchissement : 5m</option>
            </select>
            <button class="primary" onclick="App.copyNews()">COPIER LA SYNTHÈSE</button>
        </div>

        <div class="log-container">
            <h4 style="font-size:11px; color:var(--text-dim);">TERMINAL DE FLUX</h4>
            <div id="console-log"></div>
        </div>
    </aside>

    <div id="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="modal-body"></div>
            <button onclick="document.getElementById('modal').style.display='none'">FERMER LA FENÊTRE</button>
        </div>
    </div>

    <script>
        {
            const App = {
                registry: new Set(),
                data: [],
                sources: [
                    { name: "France 24", url: "https://www.france24.com/fr/actualites/rss" },
                    { name: "Le Monde", url: "https://www.lemonde.fr/rss/une.xml" },
                    { name: "Le Figaro", url: "https://www.lefigaro.fr/rss/figaro_actualites.xml" },
                    { name: "BFMTV", url: "https://www.bfmtv.com/rss/info/flux-rss/flux-toutes-les-infos/" },
                    { name: "Les Echos", url: "https://services.lesechos.fr/rss/les-echos-economie.xml" },
                    { name: "Google News", url: "https://news.google.com/rss?hl=fr&gl=FR&ceid=FR:fr" }
                ],
                config: { interval: 60000, history: 12 },
                timer: null,

                log(msg, status = '') {
                    const logEl = document.getElementById('console-log');
                    const div = document.createElement('div');
                    div.className = `log-entry ${status}`;
                    div.textContent = `> [${new Date().toLocaleTimeString()}] ${msg}`;
                    logEl.prepend(div);
                },

                async scan() {
                    this.log("Démarrage du scan global...", "ok");
                    document.querySelector('.stats-grid').classList.add('scan-active');
                    
                    let activeSources = 0;
                    const timestamp = new Date().getTime();

                    const fetchTasks = this.sources.map(async (src) => {
                        try {
                            // Utilisation d'un cache-buster pour forcer la mise à jour des éditorialistes
                            const proxyUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(src.url)}&_=${timestamp}`;
                            const res = await fetch(proxyUrl);
                            const json = await res.json();
                            
                            if (json.status === 'ok') {
                                activeSources++;
                                return json.items.map(item => ({ ...item, source: src.name }));
                            }
                            throw new Error("Timeout ou format invalide");
                        } catch (e) {
                            this.log(`Échec : ${src.name}`, "err");
                            return [];
                        }
                    });

                    const results = await Promise.all(fetchTasks);
                    const flatItems = results.flat().sort((a, b) => new Date(a.pubDate) - new Date(b.pubDate));
                    
                    flatItems.forEach(item => {
                        const hash = btoa(unescape(encodeURIComponent(item.title))).substring(0, 24);
                        if (!this.registry.has(hash)) {
                            this.registry.add(hash);
                            this.data.push(item);
                            this.render(item);
                        }
                    });

                    document.getElementById('stat-count').textContent = this.registry.size;
                    document.getElementById('stat-sources').textContent = `${activeSources}/${this.sources.length}`;
                    document.querySelector('.stats-grid').classList.remove('scan-active');
                    this.log(`Scan terminé. ${activeSources} sources actives.`);
                },

                render(item) {
                    const feed = document.getElementById('feed');
                    const time = new Date(item.pubDate).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    const div = document.createElement('div');
                    div.className = 'news-card is-fresh';
                    div.innerHTML = `
                        <div class="meta">
                            <span class="source-tag">${item.source}</span>
                            <span class="timestamp">${time}</span>
                        </div>
                        <h3 class="title">${item.title}</h3>
                        <p class="desc">${item.description.replace(/<[^>]*>?/gm, '').substring(0, 180)}...</p>
                    `;
                    div.onclick = () => {
                        div.classList.remove('is-fresh');
                        this.showModal(item);
                    };
                    feed.prepend(div);
                },

                showModal(item) {
                    const modal = document.getElementById('modal');
                    document.getElementById('modal-body').innerHTML = `
                        <h4 style="color:var(--accent)">${item.source}</h4>
                        <h1 style="margin: 10px 0 20px 0;">${item.title}</h1>
                        <p style="color:var(--text-dim); line-height:1.6; font-size:1.1rem;">
                            ${item.content || item.description}
                        </p>
                        <a href="${item.link}" target="_blank" style="color:var(--accent); display:block; margin-top:20px;">Lire l'article original ↗</a>
                    `;
                    modal.style.display = 'flex';
                },

                copyNews() {
                    const text = this.data
                        .slice(-20)
                        .reverse()
                        .map(i => `[${i.source}] ${i.title}`)
                        .join('\n');
                    navigator.clipboard.writeText(text);
                    alert("Les 20 dernières dépêches ont été copiées.");
                },

                setFreq(val) {
                    this.config.interval = parseInt(val);
                    this.startTimer();
                    this.log(`Intervalle réglé sur ${val/1000}s`);
                },

                startTimer() {
                    if (this.timer) clearInterval(this.timer);
                    this.timer = setInterval(() => this.scan(), this.config.interval);
                },

                start() {
                    document.getElementById('feed').innerHTML = '';
                    this.scan();
                    this.startTimer();
                }
            };

            window.App = App;
        }
    </script>
</body>
</html>
